<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin — Bookings</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <main>
      <h1>Admin — Bookings</h1>
      <p><a href="/">Open public site</a></p>
      <section>
        <table id="bookings" border="1" cellpadding="6">
          <thead><tr><th>Date</th><th>Time</th><th>Stylist</th><th>Customer</th><th>Phone</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>
    </main>

    <script>
    async function fetchJSON(url, opts){ const r = await fetch(url, opts); return r.json(); }

    async function load(){
      const list = await fetchJSON('/api/admin/bookings');
      const tbody = document.querySelector('#bookings tbody'); tbody.innerHTML = '';
      list.forEach(b => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${b.date}</td><td>${b.time}</td><td>${b.stylist_name} (${b.stylist_id})</td><td>${b.customer_name}</td><td>${b.customer_phone}</td><td><button data-id="${b.id}">Delete</button></td>`;
        tbody.appendChild(tr);
      });
      document.querySelectorAll('#bookings button').forEach(btn => btn.addEventListener('click', async e => {
        const id = e.target.dataset.id;
        if(!confirm('Delete booking '+id+'?')) return;
        const res = await fetch('/api/admin/bookings/'+id, {method:'DELETE'});
        if(res.ok) load(); else { const err = await res.json(); alert(err.error || 'error'); }
      }));
    }
    load();
    </script>
  </body>
</html>
